<?php

function motores_multistep_block($op = 'list', $delta = 0, $edit = array()) 
{
	switch( $op )
	{
		case 'list':
	      $blocks[0]['info'] = t('Anuncio multistep');
	      return $blocks;
	      break;
	    case 'view':
	      switch ( $delta )
	      {
			    case 0:
	          $blocks['title'] = '';
	          $blocks['content'] = motores_multistep_markup();
	          break;
	      }
	      return $blocks;
	      break;
	}
}

function motores_multistep_form_alter(&$form, &$form_state, $form_id)
{
  if ($form_id == 'carro_node_form')
  {
    $form['field_marca']['#prefix'] = '<div class="num">1</div>';
    $form['field_version']['#prefix'] = '<div class="num">1</div>';
  }
}

function motores_multistep_markup()
{
  $t[] = t('Marca y modelo');
  $t[] = t('A&ntilde;o y submodelo');
  $t[] = t('Detalles');
  $t[] = t('Fotos');
  $t[] = t('Revisi&oacute;n');
  $t[] = t('Registro');
  $t[] = t('Pago');
  $t[] = t('Tu anuncio listo');
  
  $active = -1;
  if ( strpos($_GET['q'], 'node/add/') >= 0 )
  {
    $active = 0;
  }
  if ( arg(2) == 'edit' )
  {
    $active = arg(3) - 1;
  }
  
  $r = 
  '<div class="multistep-tabs">
    <ul class="clearfix">';

  foreach ( $t as $i => $step )
  {
    $r .= '<li '.(($active == $i)?'class="active">':'>').($i+1).'. '.$step.'</li>';
  }

  $r .= '</ul>
  </div>';
    
  return $r;
}